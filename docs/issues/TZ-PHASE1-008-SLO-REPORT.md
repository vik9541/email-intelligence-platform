# Ð¢Ð—-008: Setup SLO Report Generation [Phase 1]

**Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:** âœ… Completed  
**ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚:** P2 (Medium - Reporting)  
**ÐžÑ†ÐµÐ½ÐºÐ° Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸:** 2h â†’ 0h (Already Done)  
**Ð¡Ð»Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ:** LOW  
**Ð’Ð»Ð°Ð´ÐµÐ»ÐµÑ†:** DevOps/Product  
**Sprint:** Phase 1 - Production Monitoring Stack  

---

## ðŸ“‹ Context (ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚)

Monthly SLO Report Template - ÑˆÐ°Ð±Ð»Ð¾Ð½ Ð´Ð»Ñ ÐµÐ¶ÐµÐ¼ÐµÑÑÑ‡Ð½Ñ‹Ñ… Ð¾Ñ‚Ñ‡ÐµÑ‚Ð¾Ð² stakeholders. Ð¤Ð°Ð¹Ð» `docs/MONTHLY_SLO_REPORT_TEMPLATE.md` **ÑƒÐ¶Ðµ ÑÐ¾Ð·Ð´Ð°Ð½** Ð¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚:

- **Executive Summary** - ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð·Ð° Ð¼ÐµÑÑÑ†
- **Detailed SLO Performance** - daily breakdown availability/latency
- **Incidents Summary** - P0/P1/P2 incidents Ñ MTTR
- **Trends & Analysis** - positive trends Ð¸ problem areas
- **Action Items** - high/medium/low priority Ð·Ð°Ð´Ð°Ñ‡Ð¸
- **Cost Analysis** - infrastructure costs Ð¸ cost per request
- **Next Month Goals** - targets Ð´Ð»Ñ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ð¼ÐµÑÑÑ†Ð°

Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ:
- **CTO/VP Engineering** - monthly performance reviews
- **Product Team** - impact analysis Ð½Ð° business metrics
- **DevOps/SRE** - capacity planning Ð¸ optimization

**Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸:**
- âœ… Ð¤Ð°Ð¹Ð» `docs/MONTHLY_SLO_REPORT_TEMPLATE.md` ÑÐ¾Ð·Ð´Ð°Ð½ (commit 49e37eb) â† **Ð£Ð–Ð• Ð’Ð«ÐŸÐžÐ›ÐÐ•ÐÐž**
- âœ… Prometheus recording rules Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹ (Ð¢Ð—-001)
- âœ… Grafana dashboard ÑÐ¾Ð·Ð´Ð°Ð½ (Ð¢Ð—-003)

---

## âœ… Requirements (Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ)

**Ð’ÑÐµ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ Ð£Ð–Ð• Ð’Ð«ÐŸÐžÐ›ÐÐ•ÐÐ« Ð² ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ðµ 49e37eb.**

Ð¨Ð°Ð±Ð»Ð¾Ð½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚:

### 1. âœ… Executive Summary Section
- Availability target vs actual
- Latency P95 target vs actual
- Error Budget status
- Incidents count (P0/P1/P2)
- MTTR average

### 2. âœ… Detailed Breakdown Tables
- Daily availability data (30 days)
- Latency percentiles (P50/P95/P99) Ð¿Ð¾ Ð½ÐµÐ´ÐµÐ»ÑÐ¼
- Error Budget burndown chart

### 3. âœ… Incidents Summary
- P0 incidents table (ID, Date, Duration, Root Cause, MTTR, Post-Mortem link)
- P1 incidents table
- P2 incidents summary

### 4. âœ… Trends & Analysis
- Positive trends template
- Problem areas template
- Action plan Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ problem area

### 5. âœ… Cost Analysis Section
- Monthly infrastructure costs
- Cost per request calculation
- Cost optimization opportunities

### 6. âœ… Next Month Goals
- SLO targets table
- Feature roadmap impact Ð½Ð° SLO
- Risk mitigation plans

### 7. âœ… Appendix
- Daily availability CSV data
- Latency heatmap
- Error types breakdown
- Service dependencies health
- Classification accuracy metrics

---

## âœ… Acceptance Criteria (ÐšÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¸ Ð¿Ñ€Ð¸ÐµÐ¼ÐºÐ¸)

**Ð’Ð¡Ð• ÐšÐ Ð˜Ð¢Ð•Ð Ð˜Ð˜ Ð£Ð–Ð• Ð”ÐžÐ¡Ð¢Ð˜Ð“ÐÐ£Ð¢Ð«:**

- [x] **AC1:** Ð¤Ð°Ð¹Ð» `docs/MONTHLY_SLO_REPORT_TEMPLATE.md` ÑÐ¾Ð·Ð´Ð°Ð½
- [x] **AC2:** Ð¨Ð°Ð±Ð»Ð¾Ð½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð²ÑÐµ required sections (8 ÑÐµÐºÑ†Ð¸Ð¹)
- [x] **AC3:** Tables Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ (Markdown)
- [x] **AC4:** Placeholder data Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð¾Ð² (`XX.X%`, `XXmin`)
- [x] **AC5:** Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚ Ð½Ð° Ñ€ÑƒÑÑÐºÐ¾Ð¼ ÑÐ·Ñ‹ÐºÐµ
- [x] **AC6:** Ð¡ÐµÐºÑ†Ð¸Ñ Appendix Ñ detailed metrics
- [x] **AC7:** Referencing links Ðº P0 Runbook Ð¸ Grafana
- [x] **AC8:** Report metadata (Generated by, Distribution Date)

---

## ðŸ§ª How to Test (ÐšÐ°Ðº Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ)

### Test 1: Verify File Exists

```bash
ls -lh docs/MONTHLY_SLO_REPORT_TEMPLATE.md

# Expected output:
# -rw-r--r-- 1 user user 25K Dec 14 10:00 docs/MONTHLY_SLO_REPORT_TEMPLATE.md
```

### Test 2: Generate First Real Report

```bash
# Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑˆÐ°Ð±Ð»Ð¾Ð½ Ð´Ð»Ñ December 2025
cp docs/MONTHLY_SLO_REPORT_TEMPLATE.md docs/reports/2025-12-MONTHLY-SLO-REPORT.md

# Ð—Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ð¸Ð· Prometheus
# (ÑÐ¼. Test 3 Ð´Ð»Ñ automation)
```

### Test 3: Automate Data Collection

**Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ ÑÐ±Ð¾Ñ€Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…:**

```bash
#!/bin/bash
# scripts/generate-monthly-report.sh

YEAR=$(date +%Y)
MONTH=$(date +%m)
START_DATE="${YEAR}-${MONTH}-01"
END_DATE=$(date -d "$START_DATE +1 month -1 day" +%Y-%m-%d)

# Query Prometheus Ð´Ð»Ñ availability
curl -s "http://prometheus.monitoring:9090/api/v1/query_range?query=slo:email_service:availability:ratio_rate5m&start=${START_DATE}T00:00:00Z&end=${END_DATE}T23:59:59Z&step=1d" | \
  jq -r '.data.result[0].values[] | @csv' > /tmp/availability.csv

# Query Ð´Ð»Ñ latency
curl -s "http://prometheus.monitoring:9090/api/v1/query_range?query=slo:email_service:latency:p95&start=${START_DATE}T00:00:00Z&end=${END_DATE}T23:59:59Z&step=1d" | \
  jq -r '.data.result[0].values[] | @csv' > /tmp/latency.csv

# Generate report
cat docs/MONTHLY_SLO_REPORT_TEMPLATE.md | \
  sed "s/\[ÐœÐµÑÑÑ† YYYY\]/December 2025/g" | \
  sed "s/XX.X%/$(calculate_avg_availability)/g" \
  # ... more replacements

echo "Report generated: docs/reports/2025-12-MONTHLY-SLO-REPORT.md"
```

### Test 4: Verify Markdown Rendering

```bash
# Preview Ð² GitHub Ð¸Ð»Ð¸ Markdown viewer
# Check:
# - Executive Summary table renders correctly
# - Daily breakdown table Ð½Ðµ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ wide
# - Charts (ASCII art) Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÑŽÑ‚ÑÑ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾
# - Links Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚
```

### Test 5: Validate with Stakeholders

```bash
# ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ DRAFT report Ð½Ð° review:
# 1. Tech Lead - Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ technical accuracy
# 2. Product Manager - Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ business impact section
# 3. CTO - Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ executive summary clarity
```

---

## ðŸ“Š Report Generation Workflow

### Monthly Process (1st day of month)

1. **Day 1:** Collect data from Prometheus
   ```bash
   ./scripts/generate-monthly-report.sh --month=previous
   ```

2. **Day 2:** Fill in incidents summary
   - Query PostgreSQL Ð´Ð»Ñ incidents Ð·Ð° Ð¿Ñ€Ð¾ÑˆÐ»Ñ‹Ð¹ Ð¼ÐµÑÑÑ†
   - Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ root cause analysis Ð¸Ð· post-mortems
   - Calculate MTTR average

3. **Day 3:** Add trends & analysis
   - Review Grafana dashboards Ð´Ð»Ñ trends
   - Identify problem areas
   - Create action items Ñ owners Ð¸ deadlines

4. **Day 4:** Cost analysis
   - Collect infrastructure costs Ð¾Ñ‚ cloud provider
   - Calculate cost per request
   - Identify optimization opportunities

5. **Day 5:** Review & distribute
   - Internal review (Tech Lead, DevOps)
   - Final edits
   - Send to distribution list (CTO, VP Eng, Product)

---

## ðŸ”§ Automation Script

**scripts/generate-monthly-report.sh** (optional enhancement):

```bash
#!/bin/bash
set -euo pipefail

MONTH=${1:-$(date -d '1 month ago' +%m)}
YEAR=${2:-$(date +%Y)}

OUTPUT_FILE="docs/reports/${YEAR}-${MONTH}-MONTHLY-SLO-REPORT.md"

echo "Generating SLO report for ${YEAR}-${MONTH}..."

# 1. Copy template
cp docs/MONTHLY_SLO_REPORT_TEMPLATE.md "$OUTPUT_FILE"

# 2. Replace placeholders
sed -i "s/\[ÐœÐµÑÑÑ† YYYY\]/$(date -d "${YEAR}-${MONTH}-01" +"%B %Y")/g" "$OUTPUT_FILE"
sed -i "s/\[Ð”Ð°Ñ‚Ð°\]/$(date +%Y-%m-%d)/g" "$OUTPUT_FILE"

# 3. Collect Prometheus data
echo "Querying Prometheus..."

PROM_URL="http://prometheus.monitoring:9090"
START_DATE="${YEAR}-${MONTH}-01T00:00:00Z"
END_DATE=$(date -d "${YEAR}-${MONTH}-01 +1 month -1 day" +%Y-%m-%dT23:59:59Z)

# Average availability
AVG_AVAILABILITY=$(curl -s "${PROM_URL}/api/v1/query_range?query=avg_over_time(slo:email_service:availability:ratio_rate5m[30d])&start=${START_DATE}&end=${END_DATE}&step=1d" | \
  jq -r '.data.result[0].values[-1][1] | tonumber * 100 | round')

sed -i "s/XX.X%/${AVG_AVAILABILITY}%/g" "$OUTPUT_FILE"

# 4. Collect incidents from PostgreSQL
echo "Querying incidents database..."
psql -h postgres.production -U postgres -d email_db -c \
  "SELECT count(*) FROM incidents WHERE priority='P0' AND created_at >= '${START_DATE}' AND created_at <= '${END_DATE}'" | \
  tail -n 3 | head -n 1 | xargs -I {} sed -i "s/Total P0 Incidents: X/Total P0 Incidents: {}/g" "$OUTPUT_FILE"

echo "âœ… Report generated: $OUTPUT_FILE"
echo "ðŸ“ Manual steps remaining:"
echo "   1. Fill in incidents root cause analysis"
echo "   2. Add trends & analysis commentary"
echo "   3. Update action items with owners"
echo "   4. Review cost analysis"
echo "   5. Set next month goals"
```

---

## ðŸ“‹ Checklist

**Ð’Ð¡Ð• ÐŸÐ£ÐÐšÐ¢Ð« Ð£Ð–Ð• Ð’Ð«ÐŸÐžÐ›ÐÐ•ÐÐ«:**

- [x] Template file created in docs/
- [x] Executive Summary section complete
- [x] Detailed SLO Performance section with tables
- [x] Incidents Summary section
- [x] Trends & Analysis section
- [x] Action Items section
- [x] Cost Analysis section
- [x] Next Month Goals section
- [x] Appendix with detailed metrics
- [x] Markdown formatting validated
- [x] Russian language throughout
- [x] Committed to Git (commit 49e37eb)
- [x] Pushed to GitHub

---

## ðŸ”— Related Tasks

- **Previous:** [Ð¢Ð—-007: Write P0 Incident Runbook](TZ-PHASE1-007-P0-RUNBOOK.md)
- **Next:** [Ð¢Ð—-009: Create On-Call Quick Reference Card](TZ-PHASE1-009-ONCALL-CARD.md)
- **Data Source:** Ð¢Ð—-001 (Prometheus SLO Rules), Ð¢Ð—-003 (Grafana Dashboard)

---

## ðŸ“ Notes

### Why This Task is Marked Complete

Ð¤Ð°Ð¹Ð» `docs/MONTHLY_SLO_REPORT_TEMPLATE.md` Ð±Ñ‹Ð» ÑÐ¾Ð·Ð´Ð°Ð½ Ñ€Ð°Ð½ÐµÐµ Ð² ÑÑ‚Ð¾Ð¹ Ð¶Ðµ ÑÐµÑÑÐ¸Ð¸.

Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ:
- 250+ ÑÑ‚Ñ€Ð¾Ðº comprehensive template
- 8 main sections + Appendix
- Tables, charts, formulas
- Placeholder data Ð´Ð»Ñ quick start
- Ð’ÑÐµ Ð½Ð° Ñ€ÑƒÑÑÐºÐ¾Ð¼ ÑÐ·Ñ‹ÐºÐµ

ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°:
```bash
ls -lh docs/MONTHLY_SLO_REPORT_TEMPLATE.md
git log --oneline --all | grep -i monthly
```

### Distribution List

**Internal:**
- CTO (monthly review meeting)
- VP Engineering (capacity planning)
- DevOps/SRE Team (retrospective)
- Product Team (feature impact analysis)

**External (optional):**
- Board of Directors (quarterly only)
- Investors (Ð½Ð° Ð·Ð°Ð¿Ñ€Ð¾Ñ)
- Key customers (ÐµÑÐ»Ð¸ public SLO commitments)

### Report Cadence

**Monthly:** Full SLO report (ÑÑ‚Ð¾Ñ‚ ÑˆÐ°Ð±Ð»Ð¾Ð½)  
**Weekly:** Simplified dashboard snapshot (email to #engineering)  
**Daily:** Real-time monitoring (Grafana dashboard + monitor-production.sh)  
**Ad-hoc:** Post-mortem reports (Ð¿Ð¾ÑÐ»Ðµ P0 incidents)

### Integration with Other Systems

**Jira:**
- Action items ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ ÐºÐ°Ðº Jira tickets
- Link back to report Ð² ticket description

**Confluence:**
- Report Ð¿ÑƒÐ±Ð»Ð¸ÐºÑƒÐµÑ‚ÑÑ Ð² Confluence wiki
- Historical reports accessible Ð¿Ð¾ timeline

**Slack:**
- Executive summary posted Ð² #engineering channel
- Detailed report link pinned

---

**Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¾:** 14 Ð´ÐµÐºÐ°Ð±Ñ€Ñ 2025  
**Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:** âœ… COMPLETED (Ñ„Ð°Ð¹Ð» ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚)  
**ÐÐ²Ñ‚Ð¾Ñ€:** DevOps/Product Team  
**Ð’ÐµÑ€ÑÐ¸Ñ:** 1.0
